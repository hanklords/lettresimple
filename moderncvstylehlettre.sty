\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{moderncvstylehlettre}

\setlength{\parskip}{6\p@}
\definecolor{addresscolor}{rgb}{0.45,0.45,0.45}% dark grey

\newcommand*{\name}[1]{\def\@name{#1}}
\newcommand*{\location}[1]{\def\@location{#1}}
\newcommand*{\signature}[1]{\def\@signature{#1}}
\renewcommand*{\address}[1]{\def\@address{#1}}
\renewcommand*{\addresssymbol}{\Letter~}
\renewcommand*{\emailsymbol}{\textbf{@}~}
\renewcommand*{\emaillink}{%
    \href{mailto:\@name\%20<\@email>}{{\@email}}
}

\renewcommand*{\makelettertitle}{%
  \vspace*{-4\baselineskip}
  \hspace*{-2em}
  % sender contact info
  \begin{minipage}[t]{.5\textwidth}%
    \addressfont\textcolor{addresscolor}{%
      {\bfseries\upshape\@name}\@firstdetailselementfalse%
      \ifthenelse{\isundefined{\@address}}{}{\makenewline\addresssymbol\@address}%
      \ifthenelse{\isundefined{\@mobile}}{}{\makenewline\mobilesymbol\@mobile}%
      \ifthenelse{\isundefined{\@email}}{}{\makenewline\emailsymbol\emaillink}%
    }%
  \end{minipage}
  % date
  \hfill\hbox{\@location, le \today}\par
  % recipient block
  \hfill\begin{minipage}{.5\textwidth}
    \raggedleft%
    \addressfont%
    {\bfseries\upshape\@recipientname}\\%
    \@recipientaddress%
  \end{minipage}\vspace{6\baselineskip}\par
  % opening
  \@opening\\[1.5em]%

  \hspace{0pt}\par\vspace{-\baselineskip}\vspace{-\parskip}}

\renewcommand*{\makeletterclosing}{
  \@closing\vspace{2\baselineskip}\par
  \hfill\@name\hspace{4em}\par
  \ifthenelse{\isundefined{\@signature}}{}{\raggedleft\includegraphics[width=5cm]{\@signature}}%
}
